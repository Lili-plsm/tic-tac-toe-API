# API для игры «Крестики-нолики» с использованием алгоритма минимакс

API предоставляет эндпоинты для создания и управления игрой, в которой игрок может выбрать соперника (другой пользователь или компьютер) и свой знак (X или O).  
Если выбран компьютер, его ходы рассчитываются с помощью алгоритма **минимакс**.  
Если выбран другой игрок, он может присоединиться к игре через специальный эндпоинт.

API также предоставляет:
- список игр пользователя;
- таблицу лидеров;
- информацию о текущем пользователе.

Аутентификация осуществляется с помощью **JWT access** и **refresh токенов**. Пароли пользователей хранятся в базе данных в зашифрованном (хешированном) виде с использованием безопасного алгоритма хеширования.

---

## Технологии и стек

- **Spring Boot**
- **Spring Web**  
- **Spring Data JPA**  
- **Spring Security**  
- **PostgreSQL**  
- **JJWT**  
- **SpringDoc OpenAPI**  
- **Gradle**  

---

## Установка и запуск

Для запуска проекта на локальной машине выполните команду в корне проекта:

```bash
./gradlew bootRun
```

---

## Документация API

Полная спецификация API представлена в файле [`api-documentation.yaml`](./api-documentation.yaml)

---

## Эндпоинты API

### Создание и присоединение к игре

#### `POST /init` — создание новой игры

Позволяет создать новую игру.

**Пример запроса:**
```json
{
  "gameType": "HVS_H",  // HVS_H — человек против человека; по умолчанию — против компьютера
  "playerSign": "X" // символ игрока
}
```

**Ответ:**
```json
{
  "id": "uuid-созданной-игры"
}
```

#### `GET /add/{gameId}` — присоединение второго игрока

Автоматически добавляет второго игрока к указанной игре.  
Если в игре уже два игрока — возвращается сообщение об ошибке.

#### `POST /game/{uuid}` — сделать ход

**Пример запроса:**
```json
{
  "row": 0,
  "col": 0
}
```

---

### Информация об играх

- `GET /available` — список доступных игр пользователя  
- `GET /current_game` — текущая игра со статусом `IN_PROGRESS`  
- `GET /completed/{playerId}` — список завершённых игр указанного пользователя  
- `GET /leaders/{n}` — таблица из `n` лидеров по соотношению побед, поражений и ничьих  

---

### Информация о пользователе

- `GET /info` — информация о текущем пользователе  

---

## Аутентификация

Аутентификация реализована через **JWT** access и refresh токены.

### Открытые эндпоинты

#### `POST /auth` — авторизация

**Пример запроса:**
```json
{
  "login": "lili",
  "password": "ssw0rd"
}
```

#### `POST /register` — регистрация нового пользователя

**Пример запроса:**
```json
{
  "login": "lili",
  "password": "ssw0rd"
}
```
В случае успеха возвращается код 201.

#### `POST /update_refresh` — обновление refresh токена  
Передаётся текущий refresh токен в заголовке запроса.

#### `POST /update_access` — обновление access токена  
Передаётся текущий refresh токен в заголовке запроса.

---

## Тесты

В проекте реализованы базовые тесты для проверки основных API:

- Регистрация пользователя.
- Проверяется успешная аутентификация и получение токена.
- Проверяется доступ к защищённым эндпоинтам с валидным токеном, включая эндпоинт создания игры и присоеденинения участника
- Убеждаемся, что API возвращает успешный статус (200 OK) для корректных запросов.

В тестах создаются временные записи в базе данных для проверки работы API с реальными данными.

Все тесты находятся в папке src/test/java/ru/site/web/controller

Для запуска тестов используется команда:
```bash
 ./gradlew test
```


## Контакты

- Telegram: [@mexaust](https://t.me/mexaust)  
- Email: [ssyp06510@gmail.com](mailto:ssyp06510@gmail.com)